<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - MyFirstApplication</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/MyFirstApplication.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
    <link href="~/css/style.css" rel="stylesheet" />
    <link href="~/css/lg.css" rel="stylesheet" />
    <link href="~/css/md.css" rel="stylesheet" />
    <link href="~/css/sm.css" rel="stylesheet" />

    <style>

        textarea:focus {
            border: none;
            outline: none;
            box-shadow: none;
        }

        /* ----- files to be uploaded -----  */

        .file-preview {
            position: relative;
            display: inline-block;
            margin: 5px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            width: 120px;
        }

        .file-thumbnail {
            width: 120px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            position: relative;
        }

            .file-thumbnail img {
                max-width: 100%;
                max-height: 100%;
                object-fit: cover;
            }

            .file-thumbnail .default-icon {
                font-size: 24px;
                color: #6c757d;
            }

        .file-info {
            padding: 5px 8px;
            font-size: 11px;
            color: #495057;
            border-top: 1px solid #dee2e6;
        }

        .file-name {
            font-weight: 500;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-size {
            color: #6c757d;
        }

        .file-remove {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(220, 53, 69, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

            .file-remove:hover {
                background: #dc3545;
            }

        .upload-progress {
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
            margin: 3px 8px 8px 8px;
        }

        .upload-progress-bar {
            height: 100%;
            background: #28a745;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* File type specific colors */
        .video-thumbnail {
            background: linear-gradient(135deg, #E11C1D, #ff4757);
        }

        .audio-thumbnail {
            background: linear-gradient(135deg, #0C916E, #2ed573);
        }

        .pdf-thumbnail {
            background: linear-gradient(135deg, #FF1C1D, #ff4757);
        }

            .video-thumbnail .default-icon,
            .audio-thumbnail .default-icon,
            .pdf-thumbnail .default-icon {
                color: white;
            }

        /* Uploaded files section */
        .uploaded-file {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }

        .uploaded-file-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: white;
            font-size: 16px;
        }

        .uploaded-file-info {
            flex: 1;
        }

        .uploaded-file-name {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .uploaded-file-details {
            font-size: 12px;
            color: #6c757d;
        }

    </style>

</head>



<body>

    <heade class="sticky-top z-3">

        <nav class="navbar navbar-expand-lg bg-body-white bg-light">
            <div class="container-lg flex-nowrap">
                <a class="navbar-brand" href="/">
                    <img src="https://udvash.com/media/Images/UDVASH/Common/Udvash-Logo.png"
                         alt="Logo" />
                </a>
                <div class="d-flex align-items-center">
                    <button type="button" class="btn btn-navbar d-lg-none d-inline">
                        Join Now
                    </button>
                    <button class="navbar-toggler"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#navbarSupportedContent"
                            aria-controls="navbarSupportedContent"
                            aria-expanded="false"
                            aria-label="Toggle navigation">

                        <i class="fa-solid fa-bars fa-2x"></i>
                        <i class="fa-solid fa-xmark fa-2x d-none"></i>
                    </button>
                </div>
                <div class="collapse navbar-collapse custom-collapse"
                     id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-lg-center custom-ul">
                        <li class="nav-item">
                            <a class="nav-link fs-4 fw-semibold text-black" aria-current="page" href="#">প্রোগ্রামসমূহ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link fs-4 fw-semibold text-black" href="#">শাখাসমূহ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link fs-4 fw-semibold text-black" href="/home/qna">Q&A</a>
                        </li>
                        <li>
                            <hr class="d-lg-none d-block" />
                        </li>
                        <li class="nav-item">
                            <a class="nav-link d-flex align-items-center gap-2">
                                <img src="https://udvash.com/media/Images/UDVASH/Common/callusicon.png"
                                     alt="Call" />
                                <span class="fs-4 d-lg-none d-block">09666775566</span>
                            </a>
                        </li>
                        <li class="nav-item d-lg-block d-none">
                            <button type="button" class="btn btn-navbar">Join Now</button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

    </heade>

    <div>
        <main role="main">
            @RenderBody()
        </main>
    </div>

    <!-- Footer  -->

    <footer style="background-color: #532356; color: white">
        <div class="container-lg py-3 py-md-5">
            <div class="row">
                <div class="col-12 col-md-5">
                    <img src="https://udvash.com/media/Images/UDVASH/Common/footer-logo.png"
                         alt="Logo" />
                </div>
                <div class="col-12 col-md-2">
                    <h3>Help</h3>
                    <a class="text-decoration-none text-light d-block my-3" href="#">About Us</a>
                    <a class="text-decoration-none text-light d-block my-3" href="#">Branch List</a>
                    <a class="text-decoration-none text-light d-block my-3" href="#">Privacy Policy</a>
                    <a class="text-decoration-none text-light d-block my-3" href="#">Terms & Conditions</a>
                </div>
                <div class="col-12 col-md-2">
                    <h3>Explore</h3>
                    <a class="text-decoration-none text-light d-block my-3" href="#">Programs</a>
                    <a class="text-decoration-none text-light d-block my-3" href="#">
                        Teacher Registration
                    </a>
                    <a class="text-decoration-none text-light d-block my-3" href="#">Book Correction</a>
                </div>
                <div class="col-12 col-md-3">
                    <h3>Get In Touch</h3>
                    <p class="my-3">
                        Address: 78, Green Road (3rd Floor), Farmgate, Tejgaon, Dhaka-1205
                    </p>
                    <p class="my-3">
                        Helpline:
                        <a class="text-decoration-none text-light my-3"
                           href="tel:09666775566">
                            09666775566
                        </a>
                    </p>
                    <p class="my-3">
                        Email:
                        <a class="text-decoration-none text-light my-3"
                           href="mailto:info@udvash-unmesh.com">
                            info@udvash-unmesh.com
                        </a>
                    </p>

                    <div class="d-flex align-items-center gap-3">
                        <a href="#">
                            <img src="https://unmesh.com/media/Images/Unmesh/facebook.png"
                                 alt="FB" />
                        </a>
                        <a href="#">
                            <img src="https://unmesh.com/media/Images/Unmesh/youtube.png"
                                 alt="FB" />
                        </a>
                        <a href="#">
                            <img src="https://unmesh.com/media/Images/Unmesh/instagram.png"
                                 alt="FB" />
                        </a>
                        <a href="#">
                            <img src="https://unmesh.com/media/Images/Unmesh/linkedIn.png"
                                 alt="FB" />
                        </a>
                    </div>
                </div>
            </div>

            <hr class="d-block my-4" />

            <p class="text-center small">
                Copyright © Udvash Academic & Admission Care. All rights reserved.
                2025
            </p>
        </div>
    </footer>

    <!-- Only include one Bootstrap JS bundle, and ensure it loads before your custom scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/js/all.min.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/app.js"></script>

    <script>
        $(document).ready(function(){
            $("#instruction-icon").click(function () {
                $("#instruction-modal").toggleClass("d-none");
                $(this).css("color", function (_, currentColor) {
                    return currentColor === "rgb(0, 0, 0)" ? "white" : "black";
                });
                $(this).toggleClass("bg-white");
            });

            $("#instruction-close").click(function () {
                $("#instruction-modal").addClass("d-none");
            });

            
            // ===== Uploading Files with Popover =====

            const $trigger = $('#popoverTrigger');
            const $filesToBeUploaded = $('#filesToBeUploaded');
            const $textarea = $('textarea[name="question"]');
            const $submitBtn = $('#submitBtn');
            const $viewResources = $('#view-resources');

            let selectedFiles = [];
            let uploadedFiles = [];
            let storedFiles = [];

            // Initialize popover
            const popover = new bootstrap.Popover($trigger[0], {
                trigger: 'manual',
                placement: 'top',
                html: true,
                sanitize: false
            });

            let hideTimeout;
            let popoverInitialized = false;

            // Function to check if submit should be enabled
            function checkSubmitButton() {
                const hasFiles = selectedFiles.length > 0;
                const hasText = $textarea.val().trim().length > 0;
                $submitBtn.prop('disabled', !(hasFiles || hasText));
                $submitBtn.css('opacity', hasFiles || hasText ? '1' : '0.5');
            }

            // Function to adjust textarea rows
            function adjustTextareaRows() {
                if (selectedFiles.length > 0) {
                    $textarea.attr('rows', 2);
                } else {
                    $textarea.attr('rows', 5);
                }
            }

            // Function to create file preview
            function createFilePreview(file, fileId) {
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                const fileType = file.type.split('/')[0];

                let thumbnailContent = '';
                let thumbnailClass = '';

                if (fileType === 'image') {
                    const imageUrl = URL.createObjectURL(file);
                    thumbnailContent = `<img src="${imageUrl}" alt="Preview">`;
                } else if (fileType === 'video') {
                    thumbnailClass = 'video-thumbnail';
                    thumbnailContent = '<i class="fas fa-video default-icon"></i>';
                } else if (fileType === 'audio') {
                    thumbnailClass = 'audio-thumbnail';
                    thumbnailContent = '<i class="fas fa-music default-icon"></i>';
                } else if (file.type === 'application/pdf') {
                    thumbnailClass = 'pdf-thumbnail';
                    thumbnailContent = '<i class="fas fa-file-pdf default-icon"></i>';
                }


                return `
                    <div class="file-preview" data-file-id="${fileId}">
                        <button class="file-remove" onclick="removeFile('${fileId}')">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="file-thumbnail ${thumbnailClass}">
                            ${thumbnailContent}
                        </div>
                        <div class="file-info">
                            <div class="file-name" title="${file.name}">${file.name}</div>
                            <div class="file-size">${fileSize} MB</div>
                        </div>
                        <div class="upload-progress">
                            <div class="upload-progress-bar" data-file-id="${fileId}"></div>
                        </div>
                    </div>
                `;
            }

            function createFileView(file, fileId) {
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                const fileType = file.type.split('/')[0];

                let thumbnailContent = '';
                let thumbnailClass = '';

                if (fileType === 'image') {
                    const imageUrl = URL.createObjectURL(file);
                    thumbnailContent = `<img src="${imageUrl}" alt="Preview">`;
                } else if (fileType === 'video') {
                    thumbnailClass = 'video-thumbnail';
                    thumbnailContent = '<i class="fas fa-video default-icon"></i>';
                } else if (fileType === 'audio') {
                    thumbnailClass = 'audio-thumbnail';
                    thumbnailContent = '<i class="fas fa-music default-icon"></i>';
                } else if (file.type === 'application/pdf') {
                    thumbnailClass = 'pdf-thumbnail';
                    thumbnailContent = '<i class="fas fa-file-pdf default-icon"></i>';
                }


                return `
                    <div class="file-preview" data-file-id="${fileId}">
                        <div class="file-thumbnail ${thumbnailClass}">
                            ${thumbnailContent}
                        </div>
                        <div class="file-info">
                            <div class="file-name" title="${file.name}">${file.name}</div>
                            <div class="file-size">${fileSize} MB</div>
                        </div>
                        <div class="upload-progress">
                            <div class="upload-progress-bar" data-file-id="${fileId}"></div>
                        </div>
                    </div>
                `;
            }

            // Function to simulate upload progress
            function simulateUpload(fileId) {
                const $progressBar = $(`.upload-progress-bar[data-file-id="${fileId}"]`);
                let progress = 0;

                const interval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(interval);
                    }
                    $progressBar.css('width', progress + '%');
                }, 200);
            }

            // Function to setup popover event listeners
            function setupPopoverEvents() {
                const $popoverEl = $('.popover');

                if ($popoverEl.length && !popoverInitialized) {
                    $popoverEl.on('mouseenter', function () {
                        clearTimeout(hideTimeout);
                    }).on('mouseleave', function () {
                        hideTimeout = setTimeout(() => {
                            popover.hide();
                            popoverInitialized = false;
                        }, 200);
                    });

                    $popoverEl.find('[data-upload]').on('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();

                        const uploadType = $(this).data('upload');
                        const $input = $(`#${uploadType}Input`);

                        popover.hide();
                        popoverInitialized = false;
                        $input.click();
                    });

                    popoverInitialized = true;
                }
            }

            // Show popover on hover
            $trigger.on('mouseenter', function () {
                clearTimeout(hideTimeout);
                popover.show();
                setTimeout(setupPopoverEvents, 100);
            });

            // Hide popover when leaving trigger
            $trigger.on('mouseleave', function () {
                hideTimeout = setTimeout(() => {
                    if (!$('.popover:hover').length) {
                        popover.hide();
                        popoverInitialized = false;
                    }
                }, 200);
            });

            // Handle file input changes
            $('input[type="file"]').on('change', function() {
                const files = this.files;

                if (files.length > 0) {
                    Array.from(files).forEach(file => {
                        const fileId = Date.now() + Math.random().toString(36).substr(2, 9);
                        const fileData = {
                            id: fileId,
                            file: file,
                            name: file.name,
                            size: file.size,
                            type: file.type
                        };

                        selectedFiles.push(fileData);

                        // Add file preview to the upload area
                        $filesToBeUploaded.append(createFilePreview(file, fileId));

                        // Start simulated upload
                        simulateUpload(fileId);

                        // Adjust textarea rows
                        adjustTextareaRows();

                        // Check submit button
                        checkSubmitButton();
                    });
                }

                // Reset the input
                this.value = '';
            });

            // Remove file function (global scope)
            window.removeFile = function(fileId) {
                selectedFiles = selectedFiles.filter(f => f.id !== fileId);
                $(`.file-preview[data-file-id="${fileId}"]`).remove();
                adjustTextareaRows();
                checkSubmitButton();
            };

            // Handle textarea input
            $textarea.on('input', function() {
                checkSubmitButton();
            });


            // ********************************
            function renderList() {
                const html = storedFiles.map(fileData => `
                    <div class="bg-white p-4 mt-2 rounded text-end">
                        <p><b>Date:</b> ${fileData?.date}</p>
                        <div class="bg-light p-2 w-75 rounded ms-auto">
                            <p>${fileData?.text ? fileData?.text : ""}</p>
                            <div class="d-flex flex-column gap-2">
                                ${fileData?.files ? fileData.files.map(file => createFileView(file.file, file.id)).join("") : ""}
                            </div>
                        </div>
                    </div>
                `).join("");
                $("#qna-list").html(html);
            }
            // *********************************

            // Handle submit
            $submitBtn.on('click', function() {
                const questionText = $textarea.val().trim();

                if (selectedFiles.length > 0 || questionText) {
                    // Move files to view-resources section
                    let objectToBeStored = {date: new Date().toLocaleString()};

                    if (selectedFiles.length > 0) {
                        objectToBeStored.files = selectedFiles;

                        let resourcesHtml = '<h5 class="mb-3">Uploaded Resources:</h5>';

                        selectedFiles.forEach(fileData => {
                            const fileSize = (fileData.size / 1024 / 1024).toFixed(2);
                            const fileType = fileData.type.split('/')[0];
                            let iconClass = 'fas fa-file';
                            let bgColor = '#6c757d';

                            if (fileType === 'image') {
                                iconClass = 'fas fa-image';
                                bgColor = '#0A658D';
                            } else if (fileType === 'video') {
                                iconClass = 'fas fa-video';
                                bgColor = '#E11C1D';
                            } else if (fileType === 'audio') {
                                iconClass = 'fas fa-music';
                                bgColor = '#0C916E';
                            } else if (fileData.type === 'application/pdf') {
                                iconClass = 'fas fa-file-pdf';
                                bgColor = '#FF1C1D';
                            }

                            resourcesHtml += `
                                <div class="uploaded-file">
                                    <div class="uploaded-file-icon" style="background-color: ${bgColor}">
                                        <i class="${iconClass}"></i>
                                    </div>
                                    <div class="uploaded-file-info">
                                        <div class="uploaded-file-name">${fileData.name}</div>
                                        <div class="uploaded-file-details">Size: ${fileSize} MB • Type: ${fileData.type}</div>
                                    </div>
                                </div>
                            `;
                        });

                        // $viewResources.html(resourcesHtml);
                        uploadedFiles = [...selectedFiles];
                    }

                    if (questionText) {
                        objectToBeStored.text = questionText;
                    }

                    storedFiles.push(objectToBeStored);
                    console.log(objectToBeStored);
                    renderList();

                    // Clear the form
                    selectedFiles = [];
                    $filesToBeUploaded.empty();
                    $textarea.val('');
                    adjustTextareaRows();
                    checkSubmitButton();

                    // Show success message
                    $viewResources.prepend(`
                        <div class="toast align-items-center text-white bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true">
                          <div class="d-flex">
                            <div class="toast-body">
                              Hello, world! This is a toast message.
                            </div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                          </div>
                        </div>
                    `);
                }
            });

            // Hide popover when clicking outside
            $(document).on('click', function(e) {
                if (!$trigger.is(e.target) &&
                    !$trigger.has(e.target).length &&
                    !$('.popover').is(e.target) &&
                    !$('.popover').has(e.target).length) {
                    popover.hide();
                    popoverInitialized = false;
                }
            });

            // Handle popover events
            $trigger[0].addEventListener('shown.bs.popover', function () {
                setTimeout(setupPopoverEvents, 50);
            });

            $trigger[0].addEventListener('hidden.bs.popover', function () {
                popoverInitialized = false;
                clearTimeout(hideTimeout);
            });

            checkSubmitButton();

            

        });
    </script>


    @await RenderSectionAsync("Scripts", required: false)

</body>

</html>
